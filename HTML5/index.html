<html>
	<!DOCTYPE html>
	<head>
		<script src="pattern.js"></script>
		<script src="hsupport.js"></script>
		<script src="colorfix.js"></script>
	</head>
	<body>
		<canvas id="hiddenCanvas" width="500" height="500"
			style="display:none">
			Your browser does not support the canvas element.
		</canvas>

		<canvas id="actualCanvas" width="500" height="500"
			style="border:1px solid #d3d3d3;">
			Your browser does not support the canvas element.
		</canvas>

		<script>
			/**/
var canvas = document.getElementById("hiddenCanvas");
var hctx = canvas.getContext("2d");
function changeNumber(){
	hctx.rect(0, 0, 500, 500)
	hctx.fillStyle = "#000000";
	hctx.fill();
	hctx.fillStyle = "#ffffff";
	hctx.font = "500px Verdana";
	hctx.fillText(Math.random()*10|0,105,420);
}

function pickColor(x, y, context){
	data = context.getImageData(x, y, 1, 1).data;
	return [data[0], data[1], data[2]];
}

function drawDot(x, y, r, color, context){
	context.beginPath();
	context.arc(x, y, r, 0, 2 * Math.PI, false);
	context.fillStyle = color;
	context.fill();
}

var canvas = document.getElementById("actualCanvas");
var vctx = canvas.getContext("2d");
function drawNumberBG(){
	vctx.rect(0, 0, 500, 500)
	vctx.fillStyle = "#303030";
	vctx.fill();
	vctx.font = "500px Verdana";
	vctx.fillStyle = "#ffffff";
}

//var pattern = [[10,10,10]];
function nextStep(){
	changeNumber();
	drawNumberBG();
	[bgcolor,fgcolor]=iterateColors();
	bgcolor = toHex(bgcolor);
	fgcolor = toHex(fgcolor);
	console.log(bgcolor,fgcolor);
	for (var i=0;i<pattern.length;i++){
		var dot = pattern[i];
		var c = pickColor(dot[0],dot[1],hctx);
		var color = bgcolor;
		if (c[0] == 0) {
			color = fgcolor;
		}
		drawDot(dot[0],dot[1],dot[2],color,vctx);
	}
}

setupChecker(60,5);
nextStep();

</script>

<button type="button" onclick="nextStep()">Click Me!</button>

</body>
</html>
